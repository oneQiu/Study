## 在浏览器地址栏输入`URL`会发生什么？

> 在这阶段会进行 DNS 解析、TCP 连接、HTTP 请求以及响应、客户端解析以及渲染

### DNS 解析

#### 什么是 DNS 解析？

> 当我们在浏览器输入网址的时候，它会先进行解析，转成真实的 IP 地址，作用就是充当一部字典，帮我们把难记的 IP 地址使用域名去代替

#### 解析过程

DNS 解析一般采用递归方式去解析，首先会查看是否存在缓存，缓存分为客户端缓存以及服务端缓存，客户端缓存分多种：浏览器缓存、系统缓存以及路由器缓存，都不存在会进行
ISP 缓存查询，就是服务商缓存。如果没有那么 DNS 解析会根据（特殊：本地域名服务器 ）根域名服务器 >> 顶级域名服务器 >>
权威域名服务器顺序进行解析
对此，我们可以利用 DNS 解析去做缓存优化，这样能够减少首屏加载时间，提高请求效率。

#### DNS 预解析 `dns-prefetch`

当在实际场景当中，会存在请求第三方资源的情况，无论是我们主动请求还是页面资源需要，为了能够提高减少延迟，我们可以通过预解析来提前做到
DNS 解析的功能。

```html
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
<link rel="dns-prefetch" href="https://fonts.gstatic.com/" />
```

注：避免对非跨域的地址使用，因为当你能看到时候已经解析加载完了，其次考虑搭配`preconnect`
预连接（第三方网站较少的情况下使用），如果站点是`HTTPS`服务，还会做到`TCP`连接，进一步减少延迟。

### TCP 连接

> TCP 连接的重要性是为了保证消息的有序和不丢包，建立可靠的连接
> 传输层协议

#### 三次握手

> 为什么是三次握手呢？
> 因为三次才能保证双端的收发能力都完整

- 客户端发起`SYN`包，来确认客户端需要连接的服务端端口，以及初始序号，进入`SYN_SEND`状态（客户端发送能力）
- 服务端接受后，发起`ACK`确认包，同时确认序号+1（服务端接受能力，服务端发送能力）
- 客户端再次发送`ACK`确认包，同时序号+1（客户端发送能力）

#### 四次挥手

- 当客户端需要断开连接的时候，会发送`FIN`包通知服务端，表示自己已经没有需要传送的数据了，此时接收能力还在
- 服务端接受到以后，发送确认包，表示接受到了，但是如果此时还没有关闭连接
- 服务端发送`FIN`包，进入`WAIT`状态
- 客户端接受以后，发送确认包

注：当没有数据要发送并且服务端开启了 TCP 延迟确认机制，那么第二和第三次挥手会合并发送，

### 浏览器解析以及渲染

当浏览器发起请求获取到页面需要的静态资源以后，浏览器会经过以下步骤进行解析

- 根据`html`内的结构逐步解析生成`dom tree`
- 当遇到`css`加载的时候会解析样式`css tree`
- 根据生成的双树结合成`render tree`（`css`解析不会阻塞`dom`解析，但会阻塞`render tree`生成，因为`render tree`是根据这两个生成的）
- 当遇到`js`加载的时候会停下当前的`dom`解析去加载`js`，同时会触发页面渲染（在非`async`和非`defer`情况下阻塞）

PS: 浏览器是多进程的，`GUI`渲染线程和`JS`线程也是独立的，但是存在互斥关系，为了减少页面渲染
